---
sidebar_position: 2
---

# General API Guidelines Template

This document serves as a general template and set of guidelines for all APIs developed at Techave. Project-specific guidelines should build upon these standards.

## 1. Request/Response Standards

- **Format:**
  - **Standard:** Use `application/json` for all data exchange.
  - **File Uploads:** Use `multipart/form-data` for endpoints that require binary/file uploads.
  - **Responses:** Regardless of the request format, the response **must** always be the standardized JSON envelope defined in Section 4.
- **Naming Convention:** Use `snake_case` or `camelCase` consistently across the entire API suite (Project Lead to decide per project).
- **Date/Time:** All timestamps must be in ISO 8601 format (e.g., `2024-01-15T10:00:00Z`).
- **Mandatory Headers:** All client requests must include the following headers for tracking and localization:
  - `X-Device-ID`: A unique identifier for the hardware/browser session.
  - `X-Timezone`: The client's current IANA timezone (e.g., `Asia/Jakarta`).
- **Traceability Headers:**
  - `X-Correlation-ID`: Unique ID used to trace a request across services. This is **automatically generated by the API Gateway** if not provided by the client.
- **Reliability Headers:**
  - `X-Idempotency-Key`: Optional for `GET`/`DELETE`, but **highly recommended** for `POST` and `PATCH` requests to prevent duplicate processing during retries.

## 2. Authentication & Security

- **Identity Provider:** Centralized auth for internal services.
- **Protocol:** HTTPS (TLS 1.2+) is mandatory for all environments.
- **Token Management:** JWTs should be short-lived with a valid refresh token strategy.
- **Rate Limiting:** Implement rate limiting at the API Gateway level to prevent abuse.

## 3. API Lifecycle

- **Versioning:** Apply versioning at the resource or module level rather than globally. Versioning must be included in the resource URL path (e.g., `/users/v1/...` or `/projects/v2/...`) instead of using a global prefix (like `/api/v1/...`). This allows independent segments of the API to evolve without affecting the entire system.
- **Deprecation:** Provide at least 3 months' notice via headers or documentation before retiring an endpoint.
- **Documentation:** Every API must have a corresponding OpenAPI/Swagger definition.

## 4. Response Structure & Error Handling

To ensure a consistent experience for client developers, all API responses must follow a single standardized envelope.

### 4.1 Standard Envelope

Every response must include the following top-level keys. If a field is not applicable (e.g., `error` in a success response), it must be explicitly set to `null`.

```json
{
  "data": null,
  "error": null,
  "meta": null
}
```

### 4.2 Success Responses

For successful operations, the payload is in `data` and `error` is `null`.

**Single Resource:**

```json
{
  "data": {
    "id": "uuid",
    "name": "Example"
  },
  "error": null,
  "meta": null
}
```

**Collections with Pagination:**

```json
{
  "data": [...],
  "error": null,
  "meta": {
    "page": 1,
    "limit": 15,
    "total": 100,
    "total_pages": 7
  }
}
```

### 4.3 Error Responses

For failed operations, `data` is `null` and `error` contains the details.

```json
{
  "data": null,
  "error": {
    "code": "VALIDATION_FAILED",
    "message": "The provided input is invalid.",
    "details": {
      "email": ["Must be a valid email address"]
    }
  },
  "meta": null
}
```

### 4.4 Empty States

Consistency in empty states prevents client-side crashes.

- **Collections**: If a list is empty, return an empty array `[]` in the `data` field. **Never return `null` for a collection.**
- **Single Resources**: If a specific resource is not found, return `null` for `data` and a `404 Not Found` error.

### 4.5 Standard HTTP Status Codes

| Code                  | Meaning      | Use Case                                                       |
| :-------------------- | :----------- | :------------------------------------------------------------- |
| **200 OK**            | Success      | Standard successful `GET`, `PUT`, or `POST` (non-creation).    |
| **201 Created**       | Created      | Successful `POST` that creates a new resource.                 |
| **204 No Content**    | No Content   | Successful `DELETE` or `PATCH` with no response body.          |
| **400 Bad Request**   | Syntax Error | Malformed JSON or invalid query parameters.                    |
| **401 Unauthorized**  | Global Auth  | Missing or invalid authentication token.                       |
| **403 Forbidden**     | ACL Error    | Token is valid, but user lacks permission for this resource.   |
| **404 Not Found**     | Missing      | The resource at the given URL does not exist.                  |
| **422 Unprocessable** | Validation   | Semantic errors (e.g., missing required fields, logic errors). |
| **429 Too Many**      | Rate Limit   | Client has exceeded their request quota.                       |
| **500 Server Error**  | Bug          | An unexpected error occurred on the server.                    |

## 5. Performance

- **Paging & Sorting:** Follow the standardized query parameters defined in Section 7.
- **Caching:** Resource-heavy endpoints should implement `ETag` or `Cache-Control` headers.

## 6. URL & Resource Naming

- **Casing:** Use `kebab-case` for all URL paths (e.g., `/user-profiles`, not `/userProfiles` or `/user_profiles`).
- **Resource Nouns:** Use nouns to represent resources, not verbs (e.g., `GET /users`, not `GET /getUsers`).
- **Pluralization:** Use plural nouns for collections (e.g., `/products` instead of `/product`).
- **Nesting:** Avoid nesting resources more than two levels deep (e.g., `/users/{id}/orders` is fine, but `/users/{id}/orders/{id}/items` should be avoided if possible).
- **Consistency:** Ensure path parameters follow a consistent pattern (e.g., always use `{id}` or `{uuid}`).

## 7. Standardized Query Parameters

All collection endpoints (index/list) must support the following standardized query parameters to ensure consistent integration across the platform.

### 7.1 Pagination

Use the `page` and `limit` parameters for offset-based pagination.

- `page`: The page number (1-indexed). Default: `1`.
- `limit`: Number of results per page. Default: `15`. Recommended Max: `100`.

**Example:** `GET /users?page=2&limit=50`

### 7.2 Sorting

Use the `sort` parameter to control the order of results.

- **Format:** `field:direction`
- **Directions:** `asc` (Ascending) or `desc` (Descending).
- **Multiple Fields:** Separate with commas.

**Examples:**

- Single field: `GET /users?sort=created_at:desc`
- Multiple fields: `GET /users?sort=status:asc,full_name:asc`

### 7.3 Searching

Use the `search` parameter for global text-based filtering.

- `search`: The query string to search for (partial match, case-insensitive).

**Example:** `GET /users?search=john+doe`

## 8. Complex Form-Data (File Uploads)

When using `multipart/form-data` for complex structures like arrays of files or objects containing files, follow these indexing conventions.

### 8.1 Simple Arrays

Use bracket notation with explicit indices for predictability.

- **Files Only**: `photos[0]`, `photos[1]`, `photos[2]`
- **Text Only**: `tags[0]`, `tags[1]`

### 8.2 Array of Objects with Files

When each item in an array is an object that includes both text metadata and an associated file, use the same index for all fields belonging to the same object.

**Structure:** `namespace[index][field_name]`

**Example Execution:**

- `items[0][title]`: "Profile Picture"
- `items[0][category]`: "avatar"
- `items[0][file]`: (binary file)
- `items[1][title]`: "National ID"
- `items[1][category]`: "document"
- `items[1][file]`: (binary file)

### 8.3 Important Considerations

- **Index Gaps:** Do not leave gaps in indices (e.g., don't skip from `0` to `2`).
- **Nesting Limit:** Avoid nesting objects within arrays in form-data beyond one level. If the data is deeper, consider uploading files first to a storage service and then submitting a standard JSON request with the file URLs/IDs.

## 9. Idempotency

Idempotency ensures that making the same call multiple times produces the same result, preventing accidental duplicate operations (e.g., double payments).

### 9.1 The Idempotency Key

- **Header:** `X-Idempotency-Key`
- **Scope:** Keys should be unique per user/client and per operation.
- **Format:** UUID v4 is the recommended format.

### 9.2 Backend Behavior

1. **First Request:** Process the request normally and store the response (status code and body) in a cache (e.g., Redis) indexed by the key.
2. **Subsequent Requests:** If a request arrives with an existing key:
   - If the original request is **still processing**, return a `409 Conflict`.
   - If the original request is **finished**, return the cached response immediately without re-processing.
3. **Expiration:** Idempotency keys should typically expire after 24 hours.

---

_Created: 2026-01-02_
